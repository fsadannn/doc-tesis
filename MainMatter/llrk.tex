\chapter{Método Runge-Kutta de Dormand y Prince Localmente Linealizado para EDOs de
dimensiones no pequeñas}\label{chapter:lldp}
En el Capítulo \ref{chapter:exp-int-and-ll-methods} se presentó la Aproximación Lineal Local de Orden Superior. Esta aproximación consiste en descomponer la solución de la ecuación diferencial original como la suma de las soluciones de dos ecuaciones diferenciales auxiliares, una lineal y la no lineal. En el Capítulo \ref{chapter:solve-non-smal-lineal-eq} se propusieron y utilizaron las aproximaciones Krylov-Padé para resolver la ecuación diferencial lineal auxiliar. En este capítulo se utilizará el método Runge-Kutta de Dormand y Prince para aproximar la solución de la ecuación diferencial no lineal auxiliar. Combinando estas aproximaciones se obtienen Método Runge-Kutta de Dormand y Prince Localmente Linealizado para EDOs de dimensiones no pequeñas.

Sin pérdida de generalidad consideremos el PVI autónomo $d$-dimensional
\begin{equation}\label{syst}
\frac{dx}{dt}=f(x), \; t\in[t_0,T],\end{equation}
\begin{equation}\label{systcond}
x(t_0)=x_0,
\end{equation}donde $f$ es una función diferenciable en una vecindad
$\mathfrak{D}$ del conjunto $\{x(t):t\in [t_0,T]\}$ de $\mathbb{R}^{d}$. Se asumen condiciones de Lipschitz y suavidad en la función $f$ para asegurar una solución única de esta ecuación en $\mathfrak{D}$.

\section{Fórmulas embebidas}

Sea $\left( t\right) _{h}=\left\{ t_{n}:n=0,1,\ldots ,N\right\}$ una discretización temporal con un tamaño de paso máximo $h$ definido como una secuencia de tiempos que satisfacen las condiciones $t_{0}<t_{1}<\cdots <t_{N}=T$, donde $h_{n}=t_{n+1}-t_{n}\leq h$ para $n=0,\ldots,N-1$.

Consideremos las fórmulas de Runge-Kutta localmente linealizadas de Dormand y Prince
\begin{equation} \label{lldis}
    z_{n+1}\,=\,z_n+u_s+h_n \sum_{j=1}^{s}b_j \kt_j \,\,\, \text{and} \,\,\, \
    \widehat{z}_{n+1}\,=\, z_n+u_s+h_n \sum_{j=1}^{s}\widehat{b}_j \kt_j
\end{equation}
introducidas en \cite{Jimenez14AMC} para aproximar la solución $x$ de (\ref{syst})-(\ref{systcond}) en $t_{n+1}$, para $n=0,\ldots,N -1$, donde s = 7 es el número de etapas,
\begin{equation*}
u_j=L\me{c_j M_n h_n}r,
\end{equation*}
\begin{equation*}
\kt_j = f\left( z_n+u_j+h_n \sum_{i=1}^{j-1}a_{j,i}\kt_i \right) - f( z_n) - f_x(z_n)u_j,
\end{equation*}
con $\kt_1 \equiv 0$, siendo $f_x$ la matriz jacobiana de $f$ y $a_{j,i}$, $b_j$, $\widehat{b}_j$ los coeficientes de Runge-Kutta de Dormand y Príncipe definido en la Tabla \ref{ButcherTabla}. Aquí,
\begin{equation*}
    M_{n}=\left[
    \begin{array}{cc}
        f_{x}(z_{n}) & f(z_{n}) \\
        0_{1\times d} & 0
    \end{array}
    \right] \in \mathbb{R}^{(d+1)\times (d+1)},
\end{equation*}
$ L=[I_d \;\; 0_{d\times 1}] $ and $r=[0_{1\times d}\;\; 1]^T$. Las fórmulas embebidas (\ref{lldis}) son instancias particulares de una clase más general de métodos de linealización local de alto orden propuestos en \cite{Jimenez13}.

\begin{table}[h]
	\caption{Tabla de coeficientes para las fórmulas embebidas de Dormand y Prince} \label{ButcherTabla}
	\begin{center}
		\begin{tabular}{ l@{\vrule height 5pt depth 10pt width 0pt}|lllllll}
			$0$ & \\
			$\frac{1}{5}\quad$ & $\frac{1}{5}$ \\
			$\frac{3}{10}\quad$ & $\frac{3}{40}$ & $\frac{9}{40}$ \\
			$\frac{4}{5}\quad$ & $\frac{44}{45}$ & $-\frac{56}{15}$ & $\frac{32}{9}$ \\
			$\frac{8}{9}\quad$ & $\frac{19372}{6561}$ & $-\frac{25360}{2187}$ & $\frac{64448}{6561}$ & $-\frac{212}{729}$ \\
			$1\quad$ & $\frac{9017}{3168}$ & $-\frac{355}{33}$ & $\frac{46732}{5247}$ & $\frac{49}{176}$
			& $-\frac{5103}{18656}$ \\
			$1\quad$ & $\frac{35}{384}$ & $0$ & $\frac{500}{1113}$ & $\frac{125}{192}$
			& $-\frac{2187}{6784}$ & $\frac{11}{84}$ \\
			\hline
			$\widehat{y}$ & $\frac{5179}{57600}$ & $0$ & $\frac{7571}{16695}$ & $\frac{393}{640}$
			& $-\frac{92097}{339200}$ & $\frac{187}{2100}$ & $\frac{1}{40}$
			\rule[-0.3cm]{0cm}{0.8cm} \\
			$y$ & $\frac{35}{384}$ & $0$ & $\frac{500}{1113}$ & $\frac{125}{192}$
			& $-\frac{2187}{6784}$ & $\frac{11}{84}$ & $0$
		\end{tabular}
	\end{center}
\end{table}

Las aproximaciones Krylov-Padé propuestas en el capítulo anterior serán utilizadas para aproximar los términos $u_j$ que aparecen en (\ref{lldis}). Además, para aproximar eficientemente los cinco términos $u_j$ correspondientes a los cinco únicos $c_j$ distintos de cero que según la Tabla \ref{ButcherTabla} aparecen en las fórmulas (\ref{lldis}), se utilizará combinación conveniente de la invarianza ante escalado de la base ortonormal de los subespacios de Krylov, la propiedad de flujo del operador exponencial y el Teorema 1 en~\cite{sidje1998expokit}. De hecho, con la matriz de Hessenberg superior $H^*_\mf$ resultante del algoritmo \ref{alg:Arnoldi} para $\mathcal{K}_\mf(h_nf_x,f)$, se obtiene la matriz de Hessenberg $H_\mf=H^*_\mf/h_n$ correspondiente a $\mathcal{K}_\mf(f_x,f)$, por lo que la exponencial de la matriz particionada
\begin{equation}
    \overline{H} = \left[\begin{array}{cccc}
    H_\mf & e_1 & 0_{\mf\times 1} & 0_{\mf\times 1}\\
    0_{1\times\mf} & 0 & 1 & 0\\
    0_{1\times\mf} & 0 & 0 & 1\\
    0_{1\times\mf} & 0 & 0 & 0
    \end{array}\right] \label{hhat}
\end{equation}
es calculada obteniéndose
\begin{equation}
    \me{\tau\overline{H}} = \left[\begin{array}{cccc}
    \me{\tau H_m} & \tau\phi_1(\tau H_m)e_1 & \tau^{2}\phi_2(\tau H_m)e_1 &
    \tau^{3}\phi_3(\tau H_m)e_1 \\
    & 1 & \tau & \frac{\tau^{2}}{2}\\
    &  & 1 & \tau \\
    &   &   & 1 \\
    \end{array}\right]\;. \label{phi_hhat}
\end{equation}
En particular, con $\gamma=\frac{1}{90}$, es calculada la matriz particionada $E_\gamma=\me{\gamma h_n\overline{H}}$, donde $\frac{1}{ 90}$ es el máximo común divisor de los coeficientes de Runge-Kutta $\frac{1}{5},\frac{3}{10},\frac{4}{5},\frac{8}{9} ,1$ de la Tabla \ref{ButcherTabla}. Usando la propiedad de flujo del operador exponencial se obtiene

\begin{align}
    E_{2/90}& =E_{1/90}E_{1/90} & E_{4/90}& =E_{2/90}E_{2/90}  \notag \\
    E_{8/90}& =E_{4/90}E_{4/90} & E_{16/90}& =E_{8/90}E_{8/90}  \notag \\
    E_{32/90}& =E_{16/90}E_{16/90} & E_{80/90}& =E_{32/90}E_{16/90}E_{32/90}
    \label{flow} \\
    E_{1/10}& =E_{8/90}E_{1/90} & E_{1/5}& =E_{1/10}E_{1/10}  \notag \\
    E_{2/5}& =E_{1/5}E_{1/5} & E_{4/5}& =E_{2/5}E_{2/5}  \notag \\
    E_{3/10}& =E_{1/10}E_{1/5} & E_{1}& =E_{4/5}E_{1/5}\;,  \notag
\end{align}
con lo cual las cinco matrices requeridas $E_{c_j}$ son obtenidas. Como la exponencial no puede ser calculada de forma exacta ene caso general se aproximará utilizando Padé como se explica en el Capítulo \ref{chapter:solve-non-smal-lineal-eq} obteniéndose $\widetilde{E}_{c_j}$.

Por lo tanto, utilizando la aproximación Krylov-Padé (\ref{eq:kp_aprox}) y (\ref{flow}) obtenemos las aproximaciones para cada $u_j$
\begin{eqnarray}
    \frac{1}{5}h_n\varphi_1\left(\frac{1}{5}h_n f_x\right)f & \approx & \beta   V_{\mf}\; [\widetilde{E}_{\frac{1}{5}}]_{12}\;  + \beta \hf_{\mf+1,\mf}e_\mf^T\; [\widetilde{E}_{\frac{1}{5}}]_{13}\;  v_{\mf+1} \notag \\
    \frac{3}{10}h_n\varphi_1\left(\frac{3}{10}h_n f_x\right)f & \approx & \beta   V_{\mf}\; [\widetilde{E}_{\frac{3}{10}}]_{12}\;  + \beta \hf_{\mf+1,\mf}e_\mf^T\; [\widetilde{E}_{\frac{3}{10}}]_{13}\;  v_{\mf+1} \notag \\
    \frac{4}{5}h_n\varphi_1\left(\frac{4}{5}h_n f_x\right)f & \approx & \beta   V_{\mf}\; [\widetilde{E}_{\frac{4}{5}}]_{12}\;  + \beta \hf_{\mf+1,\mf}e_\mf^T\; [\widetilde{E}_{\frac{4}{5}}]_{13}\;  v_{\mf+1} \label{phi_appox} \\
    \frac{8}{9}h_n\varphi_1\left(\frac{8}{9}h_n f_x\right)f & \approx & \beta   V_{\mf}\; [\widetilde{E}_{\frac{8}{9}}]_{12}\;  + \beta \hf_{\mf+1,\mf}e_\mf^T\; [\widetilde{E}_{\frac{8}{9}}]_{13}\;  v_{\mf+1} \notag \\
    h_n\varphi_1(h_n f_x)f & \approx &  \beta V_{\mf}\; [\widetilde{E}_1]_{12}\;  + \beta\hf_{\mf+1,\mf}e_\mf^T\; [\widetilde{E}_1]_{13}\;  v_{\mf+1}, \notag
\end{eqnarray}
donde $[\widetilde{E}_{c_j}]_{ik}$ denota la submatriz $i,k$ de la matriz particionada $\widetilde{E}_{c_j}$, $V_m$ es la matriz con base ortonormal de $\mathcal{K}_ \mf(f_x,f)$ ya calculado por el Algoritmo \ref{alg:Arnoldi} para $\mathcal{K}_\mf(h_nf_x,f)$, y $\beta=\nnorm{\nnorm{f} }_2$.

Utilizando la aproximación $(\mf , \pf ,\qf , k)$-Krylov-Padé (\ref{eq:kp_aprox}) para $u_j$ en las fórmulas embebidas (\ref{lldis}), obtenemos la Fórmulas de Runge-Kutta linealizadas localmente
\begin{equation}  \label{LLDPK scheme}
    y_{n+1}\,=\,y_n+\widetilde{u}_s+h_n \sum_{j=1}^{s}b_j \widetilde{\kt}_j \,\,\, \text{and} \,\,\, \
    \widehat{y}_{n+1}\,=\, y_n+\widetilde{u}_s+h_n \sum_{j=1}^{s}\widehat{b}_j \widetilde{\kt}_j,
\end{equation}
para integrar PVI de grandes dimensiones, donde
\begin{equation*}
    \widetilde{\kt}_j = f\left( y_n+\widetilde{u}_j+h_n \sum_{i=1}^{j-1}a_{j,i}\widetilde{\kt}_i \right) - f( y_n) - f_x(y_n)\widetilde{u}_j.
\end{equation*}
y $\widetilde{\kt}_1=0$, son $a_{j,i}$, $b_j$, $\widehat{b}_j$ los coeficientes de Runge-Kutta de  Dormand y Prince definidos en la Tabla \ref{ButcherTabla}.

Es importante destacar que, a diferencia de otros integradores exponenciales de alto orden, las fórmulas embebidas (\ref{LLDPK scheme}) involucran la aproximación de un solo vector de tiempo de función phi. En efecto, mientras que los integradores exponenciales en general requieren de aproximar varios términos de la forma $\tau^k \varphi_k(\tau A_k)b_k$ con más de un valor de $k$, las fórmulas embebidas (\ref{LLDPK scheme}) solo requieren la aproximación de la acción de una sola función phi sobre un único vector $\tau \varphi_1(\tau A_1)b_1$. Como se ha explicado anteriormente, las cinco aproximaciones $\widetilde{u}_j$ a los términos distintos de cero $c_jh_n\varphi_1(c_jh_nf_x)f$ que aparecen en (\ref{LLDPK scheme}) se calculan eficientemente en cada paso de integración por medio de solo una aproximación por un subespacio de Krylov que se construye mediante el algoritmo \ref{alg:Arnoldi} y solo una exponencial matricial mediante el método de Padé.

El siguiente teorema trata sobre la velocidad de convergencia de las fórmulas embebidas (\ref{LLDPK scheme}). Con este propósito, estas fórmulas se reescriben como
\begin{equation*}
    y_{n+1}=y_{n}+\digamma (y_{n};h_{n})\text{ \ \ \ \ y \ \ \ \ }\widehat{y}_{n+1}=y_{n}+\widehat{\digamma }(y_{n};h_{n}).
\end{equation*}


\begin{theorem}\label{theorem:lldp-convergence}
	Se $x$ solución del PVI (\ref{syst})-(\ref{systcond}) con campo vectorial $f$ seis veces continuamente diferenciable en con conjunto compacto $\mathfrak{K} \subset \mathfrak{D}$. Entonce, las formular Runge-Kutta Localmente Linealizadas (\ref{LLDPK scheme}) tienen error de truncamiento local
	\[\lvert\lvert x(t_{n+1}) - x(t_n) - \digamma(x(t_n);h_n) \rvert\rvert_2 \leq Kh_n^{\mathrm{min}\left\{ \mf+2,\pf+\qf+1 \right\}}+C h_n^{6}  \]
	\[\lvert\lvert x(t_{n+1}) - x(t_n) - \widehat{\digamma }(x(t_n);h_n) \rvert\rvert_2 \leq Kh_n^{\mathrm{min}\left\{ \mf+2,\pf+\qf+1 \right\}}+C h_n^{5}  \]
	y erro global
	\[ \lvert\lvert x(t_{n+1}) - y_{n+1} \rvert\rvert_2 \leq M h^{\mathrm{min}\left\{5,\mf+1,\pf+\qf \right\}} \]
	\[ \lvert\lvert x(t_{n+1}) - \widehat{y}_{n+1} \rvert\rvert_2 \leq M h^{\mathrm{min}\left\{ 4,\mf+1,\pf+\qf \right\}} \]
	$\forall t_{n+1},t_n\in(t)_h$ y $h$ suficientemente pequeña, donde  $K,C,M$ son constantes positivas.
\end{theorem}
\emph{Demostración} Utilizando el Teorema~\ref{theorem:Krylov-bound}, se tiene
\begin{equation}\label{proof:ErrorLinearODE}
\nnorm{\nnorm{ u_j-K_{\mf,k}^{\pf,\qf}\left(c_j h_n,f_x , f \right) }}_2 =  \nnorm{\nnorm{c_jh_n\varphi_1(c_jh_nf_x)f - K_{\mf,k}^{\pf,\qf}\left(c_j h_n, f_x , f \right) }}_2 \le Kh_n^{\mathrm{min}\left\{ \mf+2,\pf+\qf+1 \right\}},
\end{equation}
con $j=1,\ldots,7$, donde $K$ es una constante positiva. Dado que $z_{n+1} = y_n + u_7$ es la solución exacta de la EDO lineal $dz/dt=f(y_n)+f_x(y_n)(z-y_n)$ resultante de la linealización local de la ecuación~(\ref{syst}) en $t_n$ con la condición inicial $z(t_n)=y_n$ y los errores de truncamiento local de las fórmulas embebidas de Runge-Kutta de Dormand y Prince son 6 y 5, los errores de truncamiento local y global del Las fórmulas de Runge-Kutta localmente linealizadas (\ref{LLDPK scheme}) se derivan directamente del Teorema 15 en~\cite{Jimenez13} y (\ref{proof:ErrorLinearODE}). $\Box$\\

Claramente, según este resultado, las fórmulas embebidas Runge-Kutta localmente linealizadas (\ref{LLDPK scheme}) preservan la velocidad de convergencia de las fórmulas embebidas clásicas Runge-Kutta de Dormand y Prince si las desigualdades $\mf+1 \ge 5 $ y $\pf+\qf \ge 5$ se cumplen. Además, al igual que las fórmulas embebidas para pequeños PVI y otros integradores de tipo exponencial, las nuevas fórmulas embebidas (\ref{LLDPK scheme}) son capaces de integrar PVI lineales tan precisos como sea necesario independientemente de la dimensionalidad y \textit{stiffness} de las ecuaciones. Sin embargo, dado que, por construcción, las fórmulas (\ref{LLDPK scheme}) usan las fórmulas originales de Runge-Kutta de Dormand y Prince para resolver una ecuación auxiliar no lineal (ver detalles en \cite{Jimenez13, Jimenez14AMC}), las fórmulas (\ref{LLDPK scheme}) no están diseñadas para integrar PVI \textit{stiff} en general. De esta forma, las fórmulas propuestas (\ref{LLDPK scheme}) pretenden aproximar la solución de PVI grandes para los que la principal fuente de \textit{stiffness} surge de la linealización de la ecuación no lineal en consideración. Estos son precisamente la mayoría de los grandes PVI resultantes de la discretización espacial de las EDP que modelan procesos físicos, biofísicos y físico-químicos conocidos.
\begin{table}[h]
	\caption{ Valores de los coeficientes $\alpha _{i,j}$ en las fórmulas continuas (\ref{continuousLLRK45}) \newline \label{Table continuous RK}}
	\centering
	\begin{tabular}{ccccc}
		\hline
		$j\setminus i$ & $1$ & $2$ & $3$ & $4$ \\
		\hline
		$1$ & $1$ & $-183/64$ & $37/12$ & $-145/128$ \\
		$2$ & $0$ & $0$ & $0$ & $0$ \\
		$3$ & $0$ & $1500/371$ & $-1000/159$ & $1000/371$ \\
		$4$ & $0$ & $-125/32$ & $125/12$ & $-375/64$ \\
		$5$ & $0$ &	$9477/3392$ & $-729/106$ & $25515/6784$ \\
		$6$ & $0$ &	$-11/7$ & $11/3$ & $-55/28$ \\
		$7$ & $0$ & $3/2$ & $-4$ & $5/2$ \\
		\hline
	\end{tabular}
\end{table}
Cuando se requiere la solución en un conjunto denso de instantes de tiempo entre dos pasos de integración consecutivos, normalmente se utilizan fórmulas continuas para proceder con un costo computacional mínimo (consulte, por ejemplo, la Sección II.6 en \cite{hairer1993solving}). Regularmente, estas fórmulas continuas se construyen mediante una interpolación polinomial de las fórmulas de integración entre dos pasos de integración consecutivos $t_{n},t_{n+1}\in $ $ t_{h}$. Mediante una simple combinación de las fórmulas embebidas (\ref{LLDPK scheme}) con las fórmulas continuas de Runge-Kutta de Dormand y Prince dadas en \cite{hairer1993solving}, se obtiene la siguiente fórmula continua de $7$ etapas
\begin{equation}
    y(t_{n}+\theta h_{n})=y_n+\widetilde{u}(\theta
    h_{n})+h_{n}\sum_{j=1}^{7}b_{j}(t_{n}+\theta h_{n})\widetilde{\kt}_{j}\
    ,\ \ 0<\theta <1,  \label{continuousLLRK45}
\end{equation}%
 para todo $t_{n} \in $ $\left( t\right) _{h}$, donde
\begin{equation*}
    \widetilde{u}(\theta h_{n}) = K_{\mf,k}^{\pf,\qf}\left(h_n\theta, f_x , f \right)
\end{equation*}
    es el vector $d$-dimensional,
\begin{equation*}
    b_{j}(\delta )=\sum\limits_{i=1}^{4}\alpha _{i,j}\delta ^{i}
\end{equation*}
es un polinomio con coeficientes $\alpha _{i,j}$, y la función $\widetilde{\kt}_{j}$ se define como en (\ref{LLDPK scheme}). Los coeficientes $\alpha _{i,j}$, definidos en
Tabla \ref{Table continuous RK}, coinciden con las de la
fórmula continua de Runge-Kutta implementada en el código de Matlab ode$45$. Para la fórmula continua (\ref{continuousLLRK45}) se pueden definir dos salidas densas convenientes. La primera, de 4 elementos, incluye los pares $(t_{n}+\theta h_{n},y(t_{n}+\theta h_{n}))$ correspondientes a los cuatro $\theta = c_j $, con $0<c_j<1$, para la cual ya se han calculado las aproximaciones $\widetilde{u}_j$ en (\ref{LLDPK scheme}). El segundo conjunto se define con los doce valores
$\{\frac{1}{90},\frac{2}{90},\frac{4}{90},\frac{8}{90},\frac{1}{10},\frac {16}{90},c_2,c_3,\frac{32}{90},\frac{2}{5},c_4,c_5\}$ de $\theta$ para las cuales las matrices $E_\theta$ en (\ref{flow}) fueron calculados. En este caso, $\widetilde{u}(\theta h_{n})$ debe evaluarse en los ocho valores de $\theta \ne c_j$, pero sin requerir alguna nueva aproximación del subespacio de Krylov.

\section{Esquemas con tamaño de paso fijo y dimensión de Krylov variable}

\subsection{Selección de la dimensión de Krylov y orden del Padé}


\subsection{Sketch (renombrar esta sección)}

\subsection{Experimentos numéricos}


\section{Esquemas adaptativos con tamaño de paso variable}

\subsection{Estimación del tamaño de paso}

\subsection{Control del tamaño de paso}

\subsection{Reutilización del Jacobiano}

\subsection{Control del \textit{Breakdown}}

\subsection{Aproximación Krylov-Padé adaptativa}

\subsection{Sketch (renombrar esta sección)}

\subsection{Experimentos numéricos}